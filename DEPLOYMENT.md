# MFA ë°°í¬ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

ì´ í”„ë¡œì íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°°í¬ ì•„í‚¤í…ì²˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:

- **ë§ˆì´í¬ë¡œ ì•±ë“¤** (shared, header-app, pip-app, micro-app-1, micro-app-2): S3 + CloudFront
- **í˜¸ìŠ¤íŠ¸ ì•±**: ë¡œì»¬ ê°œë°œ ë˜ëŠ” ë³„ë„ ì»´í“¨íŒ… í™˜ê²½

## ğŸš€ ë°°í¬ í”„ë¡œì„¸ìŠ¤

### 1. AWS ì¸í”„ë¼ ì„¤ì •

```bash
# ê°œë°œ í™˜ê²½ ì„¤ì •
./scripts/setup-aws.sh dev

# í”„ë¡œë•ì…˜ í™˜ê²½ ì„¤ì •  
./scripts/setup-aws.sh prod us-east-1
```

### 2. GitHub Secrets ì„¤ì •

GitHub ì €ì¥ì†Œ Settings > Secrets and variables > Actionsì—ì„œ ë‹¤ìŒ ì‹œí¬ë¦¿ì„ ì¶”ê°€:

```
AWS_ACCESS_KEY_ID=your_access_key_id
AWS_SECRET_ACCESS_KEY=your_secret_access_key
```

### 3. ìˆ˜ë™ ë°°í¬

```bash
# íŠ¹ì • ì•± ë°°í¬
node scripts/deploy.js deploy shared dev
node scripts/deploy.js deploy header-app prod

# ëª¨ë“  ì•± ë°°í¬
node scripts/deploy.js deploy-all dev
```

### 4. ìë™ ë°°í¬ (GitHub Actions)

- `main` ë¸Œëœì¹˜ í‘¸ì‹œ â†’ í”„ë¡œë•ì…˜ ë°°í¬
- `develop` ë¸Œëœì¹˜ í‘¸ì‹œ â†’ ê°œë°œ í™˜ê²½ ë°°í¬
- ë³€ê²½ëœ ì•±ë§Œ ìë™ ê°ì§€í•˜ì—¬ ì„ íƒì  ë°°í¬

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

### S3 + CloudFront êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GitHub Repo   â”‚â”€â”€â”€â–¶â”‚ GitHub Actions â”‚â”€â”€â”€â–¶â”‚   S3 Buckets    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Local Host    â”‚â—€â”€â”€â”€â”‚ Import Map   â”‚â—€â”€â”€â”€â”‚  CloudFront CDN â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°°í¬ í™˜ê²½ë³„ URL

#### ê°œë°œ í™˜ê²½ (dev)
```
shared: https://mfa-shared-dev.s3.us-east-1.amazonaws.com
header-app: https://mfa-header-app-dev.s3.us-east-1.amazonaws.com
pip-app: https://mfa-pip-app-dev.s3.us-east-1.amazonaws.com
micro-app-1: https://mfa-micro-app-1-dev.s3.us-east-1.amazonaws.com
micro-app-2: https://mfa-micro-app-2-dev.s3.us-east-1.amazonaws.com
```

#### í”„ë¡œë•ì…˜ í™˜ê²½ (prod)
```
shared: https://shared.mfa-apps.com
header-app: https://header-app.mfa-apps.com
pip-app: https://pip-app.mfa-apps.com
micro-app-1: https://micro-app-1.mfa-apps.com
micro-app-2: https://micro-app-2.mfa-apps.com
```

## ğŸ”§ ë¡œì»¬ í˜¸ìŠ¤íŠ¸ ì„¤ì •

### í™˜ê²½ë³„ ì„¤ì • ì—…ë°ì´íŠ¸

```bash
# ë°°í¬ëœ ì•±ë“¤ì˜ URLì„ ë¡œì»¬ í˜¸ìŠ¤íŠ¸ì— ë°˜ì˜
node scripts/deploy.js config prod
```

ì´ ëª…ë ¹ì–´ëŠ” `host/src/config.js` íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ë°°í¬ëœ ë§ˆì´í¬ë¡œ ì•±ë“¤ì˜ URLì„ ì„¤ì •í•©ë‹ˆë‹¤.

### í˜¸ìŠ¤íŠ¸ ì•± ì‹¤í–‰

```bash
cd host
pnpm dev
```

## ğŸ“Š ëª¨ë‹ˆí„°ë§ ë° ìµœì í™”

### ìºì‹± ì „ëµ

- **JS íŒŒì¼**: 1ë…„ ìºì‹œ (immutable, íŒŒì¼ëª…ì— í•´ì‹œ í¬í•¨)
- **ê¸°íƒ€ ë¦¬ì†ŒìŠ¤**: 1ì¼ ìºì‹œ
- **CloudFront**: ê¸€ë¡œë²Œ CDNìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”

### ë°°í¬ ìµœì í™”

1. **ë³€ê²½ ê°ì§€**: `dorny/paths-filter`ë¡œ ë³€ê²½ëœ ì•±ë§Œ ë°°í¬
2. **ë³‘ë ¬ ë¹Œë“œ**: ë…ë¦½ì ì¸ ì•±ë“¤ì„ ë³‘ë ¬ë¡œ ë¹Œë“œ
3. **ì˜ì¡´ì„± ìºì‹±**: pnpm ìºì‹œì™€ node_modules ìºì‹±
4. **CloudFront ë¬´íš¨í™”**: ë°°í¬ ì™„ë£Œ í›„ ìë™ ìºì‹œ ë¬´íš¨í™”

### ë¹Œë“œ ìµœì í™”

- **Tree Shaking**: ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì½”ë“œ ì œê±°
- **Minification**: Terserë¡œ ì½”ë“œ ì••ì¶•
- **ì†ŒìŠ¤ë§µ ì œê±°**: í”„ë¡œë•ì…˜ì—ì„œ ì†ŒìŠ¤ë§µ ë¹„í™œì„±í™”
- **GZIP ì••ì¶•**: CloudFrontì—ì„œ ìë™ ì••ì¶•

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

1. **CORS ì—ëŸ¬**
   - CloudFront CORS ì •ì±… í™•ì¸
   - S3 ë²„í‚· CORS ì„¤ì • í™•ì¸

2. **ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨**
   - Import Map URL í™•ì¸
   - ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ 404 ì—ëŸ¬ í™•ì¸

3. **ìºì‹œ ë¬¸ì œ**
   - CloudFront ë¬´íš¨í™” ì‹¤í–‰
   - ë¸Œë¼ìš°ì € ìºì‹œ í´ë¦¬ì–´

### AWS ë¦¬ì†ŒìŠ¤ ì •ë¦¬

```bash
cd infrastructure/aws
terraform destroy \
  -var="environment=dev" \
  -var="aws_region=us-east-1"
```

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

ë°°í¬ ì „ í™•ì¸ì‚¬í•­:

- [ ] AWS ì¸ì¦ ì •ë³´ ì„¤ì • ì™„ë£Œ
- [ ] GitHub Secrets ì¶”ê°€ ì™„ë£Œ
- [ ] Terraform ì¸í”„ë¼ ìƒì„± ì™„ë£Œ
- [ ] ë„ë©”ì¸ ì„¤ì • ì™„ë£Œ (í”„ë¡œë•ì…˜)
- [ ] SSL ì¸ì¦ì„œ ê²€ì¦ ì™„ë£Œ (í”„ë¡œë•ì…˜)

ë°°í¬ í›„ í™•ì¸ì‚¬í•­:

- [ ] ëª¨ë“  ë§ˆì´í¬ë¡œ ì•± ë¡œë“œ í™•ì¸
- [ ] ìƒíƒœ ê³µìœ  ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ì•Œë¦¼ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
- [ ] ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ í™•ì¸
- [ ] ëª¨ë°”ì¼ ë°˜ì‘í˜• í™•ì¸

## ğŸ”® í–¥í›„ ê°œì„ ì‚¬í•­

1. **ëª¨ë‹ˆí„°ë§**: CloudWatch + X-Ray ì¶”ê°€
2. **ë³´ì•ˆ**: WAF + ë³´ì•ˆ í—¤ë” ê°•í™”
3. **ì„±ëŠ¥**: ì½”ë“œ ìŠ¤í”Œë¦¬íŒ… + ì§€ì—° ë¡œë”©
4. **í…ŒìŠ¤íŠ¸**: E2E í…ŒìŠ¤íŠ¸ ìë™í™”
5. **ë¡¤ë°±**: Blue-Green ë°°í¬ ì „ëµ